{% extends 'base.html' %}

{% block title %}Dashboard - Bellefu Radio{% endblock %}

{% block content %}
<h1>Your Dashboard</h1>

<p>Welcome back, <strong>{{ user.get_full_name|default:user.username }}</strong>!</p>

<!-- Quick Stats -->
<h2>Your Listening Statistics</h2>
<table>
    <tr>
        <th>Total Listening Sessions:</th>
        <td>{{ listening_stats.total_sessions }}</td>
    </tr>
    <tr>
        <th>Total Listening Time:</th>
        <td>{{ listening_stats.total_hours }} hours ({{ listening_stats.total_minutes }} minutes)</td>
    </tr>
    <tr>
        <th>Member Since:</th>
        <td>{{ user.date_joined|date:"M d, Y" }}</td>
    </tr>
</table>

<!-- Recent Listening History -->
<h2>Recent Listening History</h2>
{% if listening_history %}
<table>
    <thead>
        <tr>
            <th>Program/Session</th>
            <th class="hide-mobile">Date & Time</th>
            <th>Duration</th>
        </tr>
    </thead>
    <tbody>
        {% for session in listening_history %}
        <tr>
            <td>
                <strong>{{ session.station.name }}</strong>
                <br><small>{{ session.station.description|truncatewords:10 }}</small>
                <div class="hide-mobile" style="font-size: 12px; color: #666; margin-top: 4px;">
                    {{ session.started_at|date:"M d, Y H:i" }}
                </div>
            </td>
            <td class="hide-mobile">{{ session.started_at|date:"M d, Y H:i" }}</td>
            <td>{{ session.duration_minutes }} minutes</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p><a href="{% url 'listening_history' %}">View full listening history →</a></p>
{% else %}
<p>No listening history yet. Start listening to Bellefu Radio to track your sessions!</p>
<p><a href="{% url 'home' %}">Go to Home Page →</a></p>
{% endif %}

<!-- Profile Management -->
<h2>Profile Settings</h2>
<form method="POST" action="{% url 'update_profile' %}" style="max-width: 600px;">
    {% csrf_token %}
    <div class="form-group">
        <label for="first_name">First Name:</label>
        <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}">
    </div>
    <div class="form-group">
        <label for="last_name">Last Name:</label>
        <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}">
    </div>
    <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" value="{{ user.email }}">
    </div>
    <div class="form-group">
        <label for="location">Location:</label>
        <input type="text" id="location" name="location" value="{{ profile.location }}" placeholder="Your location">
    </div>
    <div class="form-group">
        <label for="bio">Bio:</label>
        <textarea id="bio" name="bio" rows="3" placeholder="Tell us about yourself">{{ profile.bio }}</textarea>
    </div>
    <div class="form-group" style="margin-bottom: 0;">
        <button type="submit" style="width: auto; padding: 10px 20px; background: #000; color: white; border: 1px solid #000; cursor: pointer;">
            Update Profile
        </button>
    </div>
</form>

<!-- Quick Links -->
<h2>Quick Links</h2>
<div class="grid">
    <div class="card">
        <h3>Listen Live</h3>
        <p>Tune in to Bellefu Radio's live programming</p>
        <p><a href="{% url 'home' %}">Go to Home Page →</a></p>
    </div>
    <div class="card">
        <h3>Program Schedule</h3>
        <p>View upcoming programs and events</p>
        <p><a href="{% url 'events' %}">View Programs →</a></p>
    </div>
    <div class="card">
        <h3>Listening History</h3>
        <p>Review your complete listening history</p>
        <p><a href="{% url 'listening_history' %}">View History →</a></p>
    </div>
</div>

{% csrf_token %}
{% endblock %}